<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="400" height="210" creationComplete="initApp()">
	<mx:Script>    
    <![CDATA[
    	import Data.Globales;
    	import Data.Utils;
  		import flash.net.URLRequest;
  		import mx.controls.Alert;
  		import mx.core.Application;
  		import mx.events.CloseEvent;	
  		import mx.events.ListEvent;
  		import mx.managers.PopUpManager;
  		import mx.rpc.Fault;
  		import mx.rpc.events.FaultEvent;
  		import mx.rpc.events.ResultEvent;
  		import mx.rpc.soap.WebService;
  		import mx.utils.ArrayUtil;

		private var xmlResult:XML;
         
		private var archivo:FileReference;
  
  		private var tipoArchivo:FileFilter = new FileFilter("Archivo PDF", "*.pdf");  
  	
  		private var global:Globales;
		private var du:Utils;
  
  		[Bindable]
  		public var nombreArchivo:String = "";
     
		public function initApp():void{ 
			du = new Utils();
			global = new Globales();
		}
   
		private function __onBrowse():void{       
	        archivo = new FileReference();
			
			archivo.addEventListener(Event.SELECT, __fileSelectionHandler); 
			archivo.addEventListener(Event.COMPLETE, __completeHandler);
			archivo.addEventListener(DataEvent.UPLOAD_COMPLETE_DATA, __uploadDataHandler);
	        
	        try{    
	          	var success:Boolean = archivo.browse();   
	        }  
	        catch (error:Error){
	        	textStatus.text = "Estatus: No es posible abrir el cuadro de selección de archivos";             
	        }
  		}
  
	  	private function __onUpload():void{
	    	var myRequest:URLRequest = new URLRequest(global.urlExp);
	    	var variables:URLVariables = new URLVariables();
	    	variables.directorio = txtDirectorio.text;
	    	myRequest.data = variables;
	    	myRequest.method = URLRequestMethod.POST;
	     
	    	try{       
	      		archivo.upload(myRequest);         
	      		textStatus.text = "Estatus: Cargando " + archivo.name + " ... ";         
	    	}  
	    	catch (error:Error){         
      			textStatus.text = "Estatus: Error de carga " + archivo.name;
	    	}
	  	}
  
  		private function __fileSelectionHandler(_e:Event):void{  
    		btnUpload.enabled = true;   
              
    		txtUploadFile.text = archivo.name;             
    		textStatus.text = "Estatus:  Haga click en el botón 'Cargar Archivo' para iniciar el proceso";
  		}
       
  		private function __completeHandler(_e:Event):void {         
    		// nothing currently done in this handler - experiment and have fun :)            
  		}
  
  		private function __uploadDataHandler(evt:DataEvent):void{
    		var myResult:XML = new XML(evt.data);
    		
    		if(myResult.status.toString() == "Success"){
	    		txtDirectorio.text = "";
	    		txtUploadFile.text = "";
	    		archivo = null;
	    		btnUpload.enabled = false;
	    		textStatus.text = "Estatus: Carga de archivo completa";
	    	}
	    	else
	    		textStatus.text = "Estatus: Error en el proceso de carga";
	    	//this.nombreArchivo = myResult.toString();
    	}
    	
	]]>
	</mx:Script>
  	<mx:Canvas id="cnvEncabezado" x="10" y="10" width="380" height="190" cornerRadius="10" borderStyle="solid" borderColor="#7B8B93" visible="true">
		<mx:TextArea width="328" height="60" id="textStatus" wordWrap="true" editable="false" enabled="true" text="Estatus: Seleccione el archivo que desea cargar" x="25" y="79"/>
	  	<mx:Button id="btnUpload" label="Cargar Archivo" enabled="false" click="__onUpload()" x="134.5" y="149"/>
	  	<mx:TextInput id="txtUploadFile" editable="false" enabled="true" x="95" y="45" width="185"/>
	  	<mx:Button id="btnBrowser" label="Buscar" enabled="true" click="__onBrowse()" x="288" y="43"/>
	  	<mx:Label id="lblArchivo" x="41" y="46" text="Archivo:"/>
	  	<mx:Label id="lblDirectorio" x="25" y="17" text="Repositorio:"/>
	  	<mx:TextInput id="txtDirectorio" x="95" y="16" width="185"/>
  	</mx:Canvas>
</mx:Canvas>